"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[2877],{15680:(e,t,n)=>{n.d(t,{xA:()=>g,yg:()=>d});var i=n(96540);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,i,o=function(e,t){if(null==e)return{};var n,i,o={},a=Object.keys(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=i.createContext({}),p=function(e){var t=i.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},g=function(e){var t=p(e.components);return i.createElement(s.Provider,{value:t},e.children)},u="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},c=i.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,s=e.parentName,g=l(e,["components","mdxType","originalType","parentName"]),u=p(n),c=o,d=u["".concat(s,".").concat(c)]||u[c]||m[c]||a;return n?i.createElement(d,r(r({ref:t},g),{},{components:n})):i.createElement(d,r({ref:t},g))}));function d(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,r=new Array(a);r[0]=c;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[u]="string"==typeof e?e:o,r[1]=l;for(var p=2;p<a;p++)r[p]=n[p];return i.createElement.apply(null,r)}return i.createElement.apply(null,n)}c.displayName="MDXCreateElement"},4681:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>r,default:()=>m,frontMatter:()=>a,metadata:()=>l,toc:()=>p});var i=n(58168),o=(n(96540),n(15680));const a={},r="Testing with Detox Copilot",l={unversionedId:"guide/testing-with-copilot",id:"guide/testing-with-copilot",title:"Testing with Detox Copilot",description:"In this tutorial, we'll explore how to use Detox Copilot to write end-to-end tests using natural language commands. Detox Copilot leverages large language models (LLMs) to translate human-readable instructions into Detox actions and assertions, making test writing more intuitive and accessible.",source:"@site/../docs/guide/testing-with-copilot.md",sourceDirName:"guide",slug:"/guide/testing-with-copilot",permalink:"/Detox/docs/next/guide/testing-with-copilot",draft:!1,editUrl:"https://github.com/wix/Detox/edit/master/docs/../docs/guide/testing-with-copilot.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Using TypeScript",permalink:"/Detox/docs/next/guide/typescript"},next:{title:"Testing WebViews",permalink:"/Detox/docs/next/guide/testing-webviews"}},s={},p=[{value:"Introduction",id:"introduction",level:2},{value:"Step 0: Setting Up Detox",id:"step-0-setting-up-detox",level:2},{value:"Step 1: Implementing a PromptHandler",id:"step-1-implementing-a-prompthandler",level:2},{value:"Implementing OpenAIPromptHandler",id:"implementing-openaiprompthandler",level:3},{value:"Step 2: Initializing Detox Copilot",id:"step-2-initializing-detox-copilot",level:2},{value:"Step 3: Writing Tests with Detox Copilot",id:"step-3-writing-tests-with-detox-copilot",level:2},{value:"Writing Step-by-Step Tests",id:"writing-step-by-step-tests",level:3},{value:"Best Practices for Writing Intents",id:"best-practices-for-writing-intents",level:2},{value:"Be Specific and Clear",id:"be-specific-and-clear",level:3},{value:"One Action per Step",id:"one-action-per-step",level:3},{value:"Use Exact Labels",id:"use-exact-labels",level:3},{value:"Keep Assertions Simple",id:"keep-assertions-simple",level:3},{value:"Leverage Visual Context",id:"leverage-visual-context",level:3},{value:"Avoid Ambiguity",id:"avoid-ambiguity",level:3},{value:"General Recommendations",id:"general-recommendations",level:3},{value:"FAQs",id:"faqs",level:2}],g={toc:p},u="wrapper";function m(e){let{components:t,...a}=e;return(0,o.yg)(u,(0,i.A)({},g,a,{components:t,mdxType:"MDXLayout"}),(0,o.yg)("h1",{id:"testing-with-detox-copilot"},"Testing with Detox Copilot"),(0,o.yg)("p",null,"In this tutorial, we'll explore how to use ",(0,o.yg)("strong",{parentName:"p"},"Detox Copilot")," to write end-to-end tests using natural language commands. Detox Copilot leverages large language models (LLMs) to translate human-readable instructions into Detox actions and assertions, making test writing more intuitive and accessible."),(0,o.yg)("admonition",{type:"note"},(0,o.yg)("p",{parentName:"admonition"},"Detox Copilot is integrated into Detox and requires no additional installation. For complete API details, refer to our ",(0,o.yg)("a",{parentName:"p",href:"/Detox/docs/next/api/copilot"},"Detox Copilot API documentation"),".")),(0,o.yg)("admonition",{title:"Work in Progress",type:"caution"},(0,o.yg)("p",{parentName:"admonition"},(0,o.yg)("strong",{parentName:"p"},"Note"),": Detox Copilot is in active development. APIs are subject to change in future releases.")),(0,o.yg)("h2",{id:"introduction"},"Introduction"),(0,o.yg)("p",null,"Detox Copilot simplifies the process of writing tests by allowing you to describe test steps in natural language.\nIt interprets these instructions and translates them into Detox commands. This guide will help you integrate Detox Copilot into your testing workflow and provide best practices for writing effective intents."),(0,o.yg)("p",null,(0,o.yg)("img",{alt:"Demo",src:n(67888).A,width:"800",height:"450"})),(0,o.yg)("h2",{id:"step-0-setting-up-detox"},"Step 0: Setting Up Detox"),(0,o.yg)("p",null,"Before you begin, ensure that your Detox environment is properly set up.\nIf you need assistance with the setup, refer to the ",(0,o.yg)("a",{parentName:"p",href:"docs/introduction/getting-started/"},"Detox Getting Started Guide"),"."),(0,o.yg)("h2",{id:"step-1-implementing-a-prompthandler"},"Step 1: Implementing a PromptHandler"),(0,o.yg)("p",null,"The ",(0,o.yg)("inlineCode",{parentName:"p"},"PromptHandler")," is a crucial component that interfaces with your LLM service.\nBelow is an example of how to implement a ",(0,o.yg)("inlineCode",{parentName:"p"},"PromptHandler")," using OpenAI's GPT-4 API."),(0,o.yg)("p",null,"You can adapt this code to work with other LLMs or services as needed."),(0,o.yg)("h3",{id:"implementing-openaiprompthandler"},"Implementing OpenAIPromptHandler"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-javascript"},"const { Configuration, OpenAIApi } = require('openai');\nconst path = require('path');\n\nclass OpenAIPromptHandler {\n  constructor(apiKey) {\n    const configuration = new Configuration({ apiKey });\n    this.openai = new OpenAIApi(configuration);\n  }\n\n  async runPrompt(prompt, imagePath) {\n    const messages = [\n      { role: 'system', content: 'You are a test automation assistant.' },\n      { role: 'user', content: prompt },\n    ];\n\n    // If an image is provided, \"upload\" it and include the URL in the prompt\n    if (imagePath && this.isSnapshotImageSupported()) {\n      try {\n        const imageUrl = await this.uploadImage(imagePath);\n        messages.push({\n          role: 'user',\n          content: `Here is an image for reference: ${imageUrl}`,\n        });\n      } catch (error) {\n        console.error('Error uploading image:', error);\n        throw new Error('Failed to upload image');\n      }\n    }\n\n    const response = await this.openai.createChatCompletion({\n      model: 'gpt-4',\n      messages,\n    });\n\n    return response.data.choices[0].message.content;\n  }\n\n  async uploadImage(imagePath) {\n    // Uploads the image and returns the URL\n  }\n\n  isSnapshotImageSupported() {\n    return true; // Set to true to handle image uploads\n  }\n}\n\nmodule.exports = OpenAIPromptHandler;\n")),(0,o.yg)("p",null,(0,o.yg)("strong",{parentName:"p"},"Explanation"),":"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},(0,o.yg)("inlineCode",{parentName:"strong"},"runPrompt")),": Sends the prompt to the LLM and returns the response."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},(0,o.yg)("inlineCode",{parentName:"strong"},"isSnapshotImageSupported")),": Indicates whether the LLM can handle snapshot images. If set to ",(0,o.yg)("inlineCode",{parentName:"li"},"true"),", the handler will include image URLs in the prompt and will include them when instructing Detox Copilot.")),(0,o.yg)("h2",{id:"step-2-initializing-detox-copilot"},"Step 2: Initializing Detox Copilot"),(0,o.yg)("p",null,"Initialize Detox Copilot with your ",(0,o.yg)("inlineCode",{parentName:"p"},"PromptHandler")," before running any tests.\nThis is typically done in the ",(0,o.yg)("inlineCode",{parentName:"p"},"beforeAll")," hook or a setup file."),(0,o.yg)("p",null,(0,o.yg)("strong",{parentName:"p"},"Example"),":"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-javascript"},"const { copilot } = require('detox');\nconst OpenAIPromptHandler = require('./OpenAIPromptHandler');\n\nbeforeAll(() => {\n  const promptHandler = new OpenAIPromptHandler('YOUR_OPENAI_API_KEY');\n  copilot.init(promptHandler);\n});\n")),(0,o.yg)("h2",{id:"step-3-writing-tests-with-detox-copilot"},"Step 3: Writing Tests with Detox Copilot"),(0,o.yg)("p",null,"With Detox Copilot initialized, you can now write tests using the ",(0,o.yg)("inlineCode",{parentName:"p"},"copilot.perform")," method."),(0,o.yg)("h3",{id:"writing-step-by-step-tests"},"Writing Step-by-Step Tests"),(0,o.yg)("p",null,"Detox Copilot allows you to write tests by providing a sequence of natural language instructions. Each instruction corresponds to a single action or assertion."),(0,o.yg)("p",null,(0,o.yg)("strong",{parentName:"p"},"Example"),":"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-javascript"},"it('should log in successfully', async () => {\n  await copilot.perform(\n    'Launch the app',\n    'Tap on the \"Login\" button',\n    'Enter \"user@example.com\" into the \"Email\" field',\n    'Enter \"password123\" into the \"Password\" field',\n    'Tap on the \"Submit\" button',\n    'Verify that the \"Welcome\" message is displayed'\n  );\n});\n")),(0,o.yg)("p",null,(0,o.yg)("strong",{parentName:"p"},"Explanation"),":"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"Step-by-Step Instructions"),": Each step is a separate string, representing a single action or assertion."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"Sequential Execution"),": Steps are executed in order, allowing you to describe complex interactions intuitively.")),(0,o.yg)("h2",{id:"best-practices-for-writing-intents"},"Best Practices for Writing Intents"),(0,o.yg)("p",null,"To make the most out of Detox Copilot, consider the following best practices when writing your intents:"),(0,o.yg)("h3",{id:"be-specific-and-clear"},"Be Specific and Clear"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"Provide Clear Instructions"),": The clearer your instructions, the better Copilot can interpret them."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"Example"),":",(0,o.yg)("ul",{parentName:"li"},(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"Good"),": ",(0,o.yg)("inlineCode",{parentName:"li"},"'Tap on the \"Login\" button'")),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"Better"),": ",(0,o.yg)("inlineCode",{parentName:"li"},"'Tap on the \"Login\" button located at the top right corner'"))))),(0,o.yg)("h3",{id:"one-action-per-step"},"One Action per Step"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("p",{parentName:"li"},(0,o.yg)("strong",{parentName:"p"},"Avoid Combining Multiple Actions"),": Keep each step focused on a single action or assertion.")),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("p",{parentName:"li"},(0,o.yg)("strong",{parentName:"p"},"Example"),":"),(0,o.yg)("ul",{parentName:"li"},(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"Avoid"),": ",(0,o.yg)("inlineCode",{parentName:"li"},"'Tap on the \"Login\" button and enter credentials'")),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"Prefer"),":")),(0,o.yg)("pre",{parentName:"li"},(0,o.yg)("code",{parentName:"pre",className:"language-javascript"},'\'Tap on the "Login" button\',\n\'Enter "user@example.com" into the "Email" field\'\n')))),(0,o.yg)("h3",{id:"use-exact-labels"},"Use Exact Labels"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"Refer to UI Elements Precisely"),": Use the exact text or identifiers as they appear in the app."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"Example"),":",(0,o.yg)("ul",{parentName:"li"},(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"Good"),": ",(0,o.yg)("inlineCode",{parentName:"li"},'\'Enter "password123" into the "Password" field\'')),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"Avoid"),": ",(0,o.yg)("inlineCode",{parentName:"li"},"'Enter password into its field'"))))),(0,o.yg)("h3",{id:"keep-assertions-simple"},"Keep Assertions Simple"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"Focus on Specific Outcomes"),": Make assertions straightforward and specific."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"Example"),":",(0,o.yg)("ul",{parentName:"li"},(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"Good"),": ",(0,o.yg)("inlineCode",{parentName:"li"},"'Verify that the \"Welcome\" message is displayed'")),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"Avoid"),": ",(0,o.yg)("inlineCode",{parentName:"li"},"'Check if the welcome message appears correctly on the screen'"))))),(0,o.yg)("h3",{id:"leverage-visual-context"},"Leverage Visual Context"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"Utilize Visual Descriptions"),": If your LLM supports image snapshots, include visual context in your intents."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"Example"),": ",(0,o.yg)("inlineCode",{parentName:"li"},"'Ensure the profile picture is visible at the top of the screen'"))),(0,o.yg)("h3",{id:"avoid-ambiguity"},"Avoid Ambiguity"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"Specify Elements Precisely"),": If multiple elements could match, provide additional details."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"Example"),":",(0,o.yg)("ul",{parentName:"li"},(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"Ambiguous"),": ",(0,o.yg)("inlineCode",{parentName:"li"},"'Tap on the \"Submit\" button'")),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"Specific"),": ",(0,o.yg)("inlineCode",{parentName:"li"},"'Tap on the \"Submit\" button in the registration form'"))))),(0,o.yg)("h3",{id:"general-recommendations"},"General Recommendations"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"Flexibility"),": While it's best to provide clear instructions, Copilot is designed to interpret a variety of phrasing. Different approaches can work, and you are encouraged to experiment."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"Feedback Loop"),": Observe how Copilot interprets your instructions and adjust accordingly.")),(0,o.yg)("h2",{id:"faqs"},"FAQs"),(0,o.yg)("p",null,(0,o.yg)("strong",{parentName:"p"},"Q"),": Do I need to install Detox Copilot separately?"),(0,o.yg)("p",null,(0,o.yg)("strong",{parentName:"p"},"A"),": No, Detox Copilot is integrated into Detox and requires no additional installation."),(0,o.yg)("hr",null),(0,o.yg)("p",null,(0,o.yg)("strong",{parentName:"p"},"Q"),": Which LLMs are recommended for use with Detox Copilot?"),(0,o.yg)("p",null,(0,o.yg)("strong",{parentName:"p"},"A"),": We recommend using advanced models like ",(0,o.yg)("strong",{parentName:"p"},"Sonnet 3.5")," or ",(0,o.yg)("strong",{parentName:"p"},"GPT-4o")," for better performance and understanding of complex instructions."),(0,o.yg)("hr",null),(0,o.yg)("p",null,(0,o.yg)("strong",{parentName:"p"},"Q"),": How can I provide feedback or contribute to Detox Copilot?"),(0,o.yg)("p",null,(0,o.yg)("strong",{parentName:"p"},"A"),": Contributions are welcome! Visit the ",(0,o.yg)("a",{parentName:"p",href:"https://github.com/wix-incubator/detox-copilot"},"Detox Copilot GitHub Repository")," to open issues or pull requests if they are relevant to the core-library functionality or open a it under ",(0,o.yg)("a",{parentName:"p",href:"https://github.com/wix/Detox"},"Detox repository")," if it is related to Detox-Copilot integration or if you are not sure where the issue should be opened."),(0,o.yg)("hr",null),(0,o.yg)("p",null,(0,o.yg)("strong",{parentName:"p"},"Q"),": These are heavy operations for a test (uploading images, calling an LLM). Do you optimize it in any way?"),(0,o.yg)("p",null,(0,o.yg)("strong",{parentName:"p"},"A"),": Detox Copilot is designed to avoid unnecessary calls to the LLM service and optimize performance using static cache that is based on the current state of the app.\nThis minimizes the number of calls to the LLM service and reduces latency.\nHowever, you can optimize your ",(0,o.yg)("inlineCode",{parentName:"p"},"PromptHandler")," implementation to reduce latency and improve response times (e.g., by reducing the image size or implementing a server-side cache).\nWe have plans to optimize even further by introducing more advanced caching mechanisms for better performance."))}m.isMDXComponent=!0},67888:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/copilot-demo-6f1e5193e3cea07de196d443153fcd3a.gif"}}]);